



%%  'AG8_trials.pkl';

animal = 'AG8'
nmorphs = 22;

% X = [[  0.,   8.,  75.],
%        [  1.,   9.,  38.],
%        [  2.,   7.,  38.],
%        [  3.,  16.,  38.],
%        [  4.,  13.,  31.],
%        [  5.,  14.,  37.],
%        [  6.,  23.,  38.],
%        [  7.,  19.,  38.],
%        [  8.,  22.,  37.],
%        [  9.,  23.,  37.],
%        [ 10.,  26.,  38.],
%        [ 11.,  26.,  38.],
%        [ 12.,  28.,  39.],
%        [ 13.,  34.,  38.],
%        [ 14.,  35.,  39.],
%        [ 15.,  36.,  38.],
%        [ 16.,  34.,  38.],
%        [ 17.,  35.,  37.],
%        [ 18.,  34.,  37.],
%        [ 19.,  35.,  38.],
%        [ 20.,  33.,  37.],
%        [ 21.,  72.,  76.]];

X = [[  0.,   8.,  75.],
       [  1.,  12.,  60.],
       [  2.,   8.,  61.],
       [  3.,  18.,  61.],
       [  4.,  18.,  54.],
       [  5.,  21.,  60.],
       [  6.,  33.,  61.],
       [  7.,  35.,  61.],
       [  8.,  37.,  60.],
       [  9.,  42.,  60.],
       [ 10.,  45.,  61.],
       [ 11.,  44.,  61.],
       [ 12.,  47.,  62.],
       [ 13.,  53.,  61.],
       [ 14.,  55.,  62.],
       [ 15.,  57.,  61.],
       [ 16.,  53.,  61.],
       [ 17.,  55.,  60.],
       [ 18.,  57.,  60.],
       [ 19.,  56.,  60.],
       [ 20.,  33.,  37.],
       [ 21.,  72.,  76.]];
   
data = zeros(size(X));


%% 'AG6_trials.pkl'

animal = 'AG6'
nmorphs = 22;
% 
% X = [[  0.,  16.,  37.],
%        [  4.,  21.,  29.],
%        [  5.,  22.,  37.],
%        [  6.,  26.,  39.],
%        [  7.,  31.,  39.],
%        [  8.,  30.,  37.],
%        [  9.,  30.,  38.],
%        [ 10.,  25.,  37.],
%        [ 11.,  34.,  38.],
%        [ 12.,  33.,  38.],
%        [ 13.,  35.,  38.],
%        [ 14.,  37.,  38.],
%        [ 15.,  36.,  37.],
%        [ 16.,  36.,  37.],
%        [ 17.,  35.,  38.],
%        [ 18.,  32.,  37.],
%        [ 19.,  38.,  38.],
%        [ 20.,  36.,  38.],
%        [ 21.,  35.,  38.]];

X = [[  0.,  30.,  75.],
       [  1.,  16.,  38.],
       [  2.,  20.,  38.],
       [  3.,  23.,  37.],
       [  4.,  21.,  29.],
       [  5.,  22.,  37.],
       [  6.,  26.,  39.],
       [  7.,  31.,  39.],
       [  8.,  30.,  37.],
       [  9.,  30.,  38.],
       [ 10.,  25.,  37.],
       [ 11.,  34.,  38.],
       [ 12.,  33.,  38.],
       [ 13.,  35.,  38.],
       [ 14.,  37.,  38.],
       [ 15.,  36.,  37.],
       [ 16.,  36.,  37.],
       [ 17.,  35.,  38.],
       [ 18.,  32.,  37.],
       [ 19.,  38.,  38.],
       [ 20.,  36.,  38.],
       [ 21.,  71.,  75.]];

data = zeros(size(X));


%% 'AG4_trials.pkl'

animal = 'AG4'
nmorphs = 22;

% X = [[  0.,  26.,  64.],
%        [  1.,  18.,  33.],
%        [  2.,  14.,  32.],
%        [  3.,  14.,  32.],
%        [  4.,  10.,  24.],
%        [  5.,  14.,  31.],
%        [  6.,  16.,  31.],
%        [  7.,  23.,  32.],
%        [  8.,  23.,  32.],
%        [  9.,  22.,  32.],
%        [ 10.,  21.,  32.],
%        [ 11.,  26.,  31.],
%        [ 12.,  28.,  33.],
%        [ 13.,  28.,  33.],
%        [ 14.,  29.,  33.],
%        [ 15.,  28.,  31.],
%        [ 16.,  30.,  32.],
%        [ 17.,  29.,  32.],
%        [ 18.,  30.,  33.],
%        [ 19.,  30.,  32.],
%        [ 20.,  31.,  32.],
%        [ 21.,  64.,  64.]];

X = [[  0.,  26.,  64.],
       [  1.,  22.,  51.],
       [  2.,  20.,  51.],
       [  3.,  18.,  50.],
       [  4.,  19.,  43.],
       [  5.,  20.,  50.],
       [  6.,  30.,  49.],
       [  7.,  34.,  51.],
       [  8.,  33.,  50.],
       [  9.,  36.,  51.],
       [ 10.,  36.,  51.],
       [ 11.,  41.,  50.],
       [ 12.,  45.,  52.],
       [ 13.,  45.,  51.],
       [ 14.,  46.,  51.],
       [ 15.,  43.,  49.],
       [ 16.,  47.,  51.],
       [ 17.,  45.,  50.],
       [ 18.,  48.,  52.],
       [ 19.,  49.,  51.],
       [ 20.,  31.,  32.],
       [ 21.,  64.,  64.]];

data = zeros(size(X));


%%  'AG2_trials.pkl'

animal = 'AG2'
nmorphs = 22;

% X = [[  0.,   9.,  70.],
%        [  1.,   9.,  36.],
%        [  2.,   4.,  35.],
%        [  3.,   8.,  35.],
%        [  4.,   8.,  26.],
%        [  5.,   7.,  31.],
%        [  6.,  15.,  32.],
%        [  7.,  16.,  33.],
%        [  8.,  21.,  33.],
%        [  9.,  25.,  33.],
%        [ 10.,  25.,  34.],
%        [ 11.,  28.,  34.],
%        [ 12.,  31.,  32.],
%        [ 13.,  30.,  33.],
%        [ 14.,  31.,  32.],
%        [ 15.,  32.,  32.],
%        [ 16.,  34.,  34.],
%        [ 17.,  29.,  32.],
%        [ 18.,  34.,  34.],
%        [ 19.,  30.,  32.],
%        [ 20.,  31.,  31.],
%        [ 21.,  68.,  68.]];
%    

X = [[  0.,   9.,  70.],
       [  1.,  10.,  57.],
       [  2.,   7.,  56.],
       [  3.,  11.,  57.],
       [  4.,  10.,  47.],
       [  5.,  16.,  52.],
       [  6.,  27.,  53.],
       [  7.,  26.,  55.],
       [  8.,  34.,  55.],
       [  9.,  44.,  54.],
       [ 10.,  41.,  55.],
       [ 11.,  48.,  55.],
       [ 12.,  52.,  54.],
       [ 13.,  50.,  54.],
       [ 14.,  51.,  53.],
       [ 15.,  53.,  53.],
       [ 16.,  55.,  55.],
       [ 17.,  49.,  53.],
       [ 18.,  55.,  55.],
       [ 19.,  52.,  54.],
       [ 20.,  31.,  31.],
       [ 21.,  68.,  68.]];

data = zeros(size(X));

%% Set file paths:

clear all;
clc


matdir = '/share/coxlab-behavior/mworks-data/three_port_morphs/pnas/matfiles/';

figdir = '/share/coxlab-behavior/mworks-data/three_port_morphs/pnas/figures/';


%% LOAD .mat

use_success = 0;

if use_success
    load([matdir, 'P_success.mat']);
else
    load([matdir, 'P_choice.mat']);
end

animals = fields(mdata);

for a=1:length(animals)
    curr_animal = animals(a);
    curr_animal = curr_animal{1};
    animal_name = strsplit(curr_animal, '_');
    animal_name = animal_name{1};
    
    data = mdata.(curr_animal);
    nmorphs = size(data,1);
%     data(:,1) = (data(:,1)/nmorphs)*100;
    
	if use_success
%         data(:,1) = (data(:,1)/nmorphs)*100;
        dataA = data(12:22,:);
        dataA(:,1) = [0:10:100]; %dataA(:,1)/(nmorphs-1)*100
        
        dataB = data(1:11,:);
        dataB(:,1) = flipud(dataB(:,1))*10; %dataB(:,1)/((nmorphs/2)-1)*100;
        dataB = flipud(dataB);
        D = {dataA, dataB};
        Dlabels = {'A', 'B'};
    else
        data(:,1) = (data(:,1)/nmorphs)*100;
        D = {data};
        Dlabels = {'C'};
    end


    %% GET FIT
    if length(D)>1
        options.expType        = '2AFC';
    else
        options.expType        = 'YesNo';
    end
    
    options.sigmoidName = 'norm';
    % options.sigmoidName = 'logn'; % doesn't work
    % options.sigmoidName = 'weibull'; % doesn't work
    % options.sigmoidName = 'gumbel';

    %     result = psignifit(data,options);

    %PLOT


    plotOptions.h              = gca;                  % axes handle to plot in
    plotOptions.dataColor      = [0,105/255,170/255];  % colour of the data points
    plotOptions.plotData       = 1;                    % Shall the data be plotted at all?
    plotOptions.lineColor      = [0,0,0];              % Colour of the psychometric function
    plotOptions.lineWidth      = 2;                    % Thickness of the psychometric function
    plotOptions.xLabel         = 'Morph Percent';     % X-Axis label
    % plotOptions.yLabel         = 'Percent Choose Right';    % Y-Axis label
    plotOptions.labelSize      = 15;                   % Font size for labels
    plotOptions.fontSize       = 10;                   % Tick Font size
    plotOptions.fontName       = 'Helvetica';          % Font type
    plotOptions.tufteAxis      = false;                % use custom drawn axis 
    plotOptions.plotPar        = true;                 % plot indications of threshold and asymptotes
    plotOptions.aspectRatio    = false;                % sets the aspect ratio to a golden ratio
    plotOptions.extrapolLength = .2;                   % how far to extrapolate from the data
                                                       % (in proportion of the data range) 
    plotOptions.CIthresh       = true;                % plot a confidence interval at threshold


    
    for d=1:length(D)
        if length(D) > 1
            plotOptions.yLabel         = 'Percent Correct';    % Y-Axis label
        else
            plotOptions.yLabel         = 'Percent Choose Right';    % Y-Axis label
        end
        result = psignifit(D{d},options);
        plotPsych(result, plotOptions)

        title(sprintf('%s, fit: %s', animal_name, options.sigmoidName))
    
        anchor = Dlabels{d};
        imname = sprintf('%s_fit_%s_psignifit_pcorrect%s', animal_name, options.sigmoidName, anchor);
        impath = [figdir, imname]

        savefig(impath)
        %saveas(gcf, impath, 'epsc')
        saveas(gcf, impath, 'png')
    end
    
    
%     else
%         plotOptions.yLabel         = 'Percent Choose Right';    % Y-Axis label
%         result = psignifit(data,options);
% 
%         plotPsych(result, plotOptions)
% 
%         title(sprintf('%s, fit: %s', animal_name, options.sigmoidName))
% 
%         imname = sprintf('%s_fit_%s_psignifit_pchooseright', animal_name, options.sigmoidName);
%         impath = [figdir, imname]
% 
%         savefig(impath)
%         saveas(gcf, impath, 'epsc')
%         saveas(gcf, impath, 'png')
%     end

end